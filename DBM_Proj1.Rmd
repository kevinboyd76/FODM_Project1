---
title: "ProjectDBM"
author: "Shika, Kevin, Laura"
date: ""
output: "pdf_document"
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(dpi=1000)
version
```


```{r  include=FALSE}
# Reading orginal files
library(dplyr)
library(tidyr)
library(magrittr)
library(ggplot2)
hepb=read.csv("~/Documents/DB/Project/FODM_Project1/hepatitis-b-incidence-sdgs.csv")
#head(hepb)
colnames(hepb)[4]="HepatitisTotalCases"

tuberc=read.csv("~/Documents/DB/Project/FODM_Project1/incidence-of-tuberculosis-sdgs.csv")
#head(tuberc)
colnames(tuberc)[4] <- "TuberculosisCasesPer100000ppl"

measles=read.csv("~/Documents/DB/Project/FODM_Project1/reported-cases-of-measles.csv")
#head(measles)
colnames(measles)[4]="MeaslesTotalCases"

polio=read.csv("~/Documents/DB/Project/FODM_Project1/the-number-of-reported-paralytic-polio-cases.csv")
#head(polio)
colnames(polio)[4]="PolioTotalCases"

```


# Distribution of diseases 
Cases per year across the world and Cases per year in US
```{r, echo=FALSE ,message=FALSE, warning=FALSE,  fig.width = 7, fig.align = "center"}
# Disease plots
# worldwide incidence per year
p3 <- ggplot(hepb, aes(x=Year, y=HepatitisTotalCases)) +
  geom_bar(stat = "identity", fill = "seagreen") +
  ggtitle("Worldwide Hepetitis B") +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, size=12), axis.title.y = element_blank())

# USA
ushep=hepb %>% 
  filter(Code == "USA") %>%
  ggplot(aes(x=Year, y=HepatitisTotalCases)) +
  geom_bar(stat = "identity", fill = "seagreen") +
  ggtitle("Hepatitis B in the USA") +
  ylab("Hepatitis B Incidence") +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, size=12), axis.title.y = element_blank())

# worldwide incidence per year
p4 <- ggplot(tuberc, aes(x=Year, y=TuberculosisCasesPer100000ppl)) +
  geom_bar(stat = "identity", fill = "coral2") +
  ggtitle("Worldwide Tuberculosis") +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, size=12), axis.title.y = element_blank())

# USA
usatuberc=tuberc %>% 
  filter(Code == "USA") %>%
  ggplot(aes(x=Year, y=TuberculosisCasesPer100000ppl)) +
  geom_bar(stat = "identity", fill = "coral2") +
  ggtitle("Tuberculosis in the USA") +
  ylab("Tuberculosis Incidence per 100000") +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, size=12), axis.title.y = element_blank())

p5 <- ggplot(polio, aes(x=Year, y=PolioTotalCases)) +
  geom_bar(stat = "identity", fill = "seagreen") +
  ggtitle("Worldwide cases of Polio") +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, size=12), axis.title.y = element_blank())

# USA
usapolio=polio %>% 
  filter(Code == "USA") %>%
  ggplot(aes(x=Year, y=PolioTotalCases)) +
  geom_bar(stat = "identity", fill = "seagreen") +
  ggtitle("Polio in the USA") +
  ylab("Polio Incidences") +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, size=12), axis.title.y = element_blank())

p6 <- ggplot(measles, aes(x=Year, y=MeaslesTotalCases)) +
  geom_bar(stat = "identity", fill = "coral2") +
  ggtitle("Worldwide cases of Measles") +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, size=12), axis.title.y = element_blank())

# USA
usameasles=measles %>% 
  filter(Code == "USA") %>%
  ggplot(aes(x=Year, y=MeaslesTotalCases)) +
  geom_bar(stat = "identity", fill = "coral2") +
  ggtitle("Measles in the USA") +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, size=12), axis.title.y = element_blank())

      
library(gridExtra)


grid.arrange(p3,p4,ushep,usatuberc, ncol=2)
grid.arrange(p5,p6,usapolio,usameasles, ncol=2)
#grid.arrange(p3,p4,p5,p6,ushep,usatuberc,usapolio,usameasles, ncol=4)



```




```{r  echo=FALSE,message=FALSE}
#Reading merged files
Measles2=read.csv("~/Documents/DB/Project/FODM_Project1/Measles2.csv")
#head(Measles2)
names(Measles2)[26] <- "MeaslesCases"
#Measles2 %>% select (Country.x, Country.y)
#as.list(unique(Measles2$Country.x ))

Polio2=read.csv("~/Documents/DB/Project/FODM_Project1/Polio2.csv")
#head(Polio2)
names(Polio2)[26] <- "PolioCases"
#as.list(unique(Polio2$Country.x ))

Hepb2=read.csv("~/Documents/DB/Project/FODM_Project1/Hepb2.csv")
#head(Hepb2)
names(Hepb2)[26] <- "HepatitisCases"
#as.list(unique(Hepb2$Country.x ))

Tuberc2=read.csv("~/Documents/DB/Project/FODM_Project1/Tuberc2.csv")
#head(Tuberc2)
names(Tuberc2)[26] <- "TuberculosisCasesPer100000ppl"
#as.list(unique(Tuberc2$Country.x ))
```



```{r  echo=FALSE, warning=FALSE,message=FALSE}
library(Hmisc)
#describe(Measles2)

all_missing=data.frame(Count=(c(sapply(Measles2, function(x) all_miss=sum(is.na(x))))), columns=names(Measles2))
all_missing[all_missing == "Income.composition.of.resources"] = "IncomeResources"
all_missing[all_missing == "percentage.expenditure"] = "%Expenditure"
#Plot!
mesmiss=all_missing %>% ggplot(aes(x=Count, y=columns, fill=columns)) + geom_col(position = "dodge") +
  xlab("Total amount of missing values") + ggtitle("Missing values per variable in Measles data") +
  geom_text(size=3,position = position_dodge(width= .5), aes(label=Count),vjust=0.5, hjust = -0.20) +
  theme(axis.text = element_text(size = 10)) + ylab("Variable")+ theme(legend.position="none") +  theme(panel.grid.major = element_blank(), axis.title.y = element_blank(),panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) + 
  theme(
  plot.title = element_text(color = "black", size = 10, face = "italic", hjust=0.5))
#mesmiss

```

## Measles vs every other attribute

+ Measles cases go down from 2000 to 20012
+ There is definetly a significant of measles cases between developed and developing. more cases in developing countries. 
+ **Now we can do an anova to see if the difference is statistically significant.**
+ life expectancy and adult mortality do not seem to have a pattern
+ Infant deaths do seem to have a linear relationship with measles cases
+ Polio inmunization vs Measles cases have an interesting graph it does look like a somewhat negative relationship which would make sense.
+ Diphtheria inmunization vs Measles cases have an interesting graph it does look like a somewhat negative relationship as well
+ **Do box plots of cases per country**
+ YouthThinness vs Measles seem to have somewhat a linear relationship
+ **What do you all think?**



```{r, echo=FALSE ,message=FALSE, warning=FALSE,  fig.width = 7, fig.align = "center"}
# Dopping Total.expenditure , Schooling , Population , Income.composite.of.resources , Hepatitis.B , GDP , Alcohol
# Dro missing thinness.5.9.years thinness..1.19.years, BMI

#Create new variable
Measles2$YouthThinness=Measles2$thinness..1.19.years + Measles2$thinness.5.9.years
Measles2=Measles2 %>% select(-thinness..1.19.years,-thinness.5.9.years)

#Dropping all with columns
Measles2=Measles2 %>% select(-Total.expenditure,-Population,-Income.composition.of.resources,-Hepatitis.B, -GDP, -Alcohol)


Measles2$Schooling[is.na(Measles2$Schooling)] <- 0
newData= na.omit(Measles2)
#sapply(newData, function(x) all_miss=sum(is.na(x)))
newData$Status=as.factor(newData$Status)
newData$Country.x=as.factor(newData$Country.x)
newData$Country.y=as.factor(newData$Country.y)
newData$Code1=as.factor(newData$Code1)
newData$Code=as.factor(newData$Code)
newData$Year=as.factor(newData$Year)
newData$logYouthThinness=log(newData$YouthThinness)

par(mfrow=c(1,2))
plot(MeaslesCases~., data = newData)
#plot(MeaslesCases~., data = newData, palatte="blue")

```
 
```{r  echo=FALSE,message=FALSE}
#head(Polio2)
all_missing=data.frame(Count=(c(sapply(Polio2, function(x) all_miss=sum(is.na(x))))), columns=names(Polio2))

all_missing[all_missing == "Income.composition.of.resources"] = "IncomeResources"
all_missing[all_missing == "percentage.expenditure"] = "%Expenditure"

#Plot!
poliomiss=all_missing %>% ggplot(aes(x=Count, y=columns, fill=columns)) + geom_col(position = "dodge") +
  xlab("Total amount of missing values") + ggtitle("Missing values per variable in Polio dataset") +
  geom_text(size=3,position = position_dodge(width= .5), aes(label=Count),vjust=0.5, hjust = -0.20) +
  theme(axis.text = element_text(size = 10)) + ylab("Variable")+ theme(legend.position="none") +  theme(panel.grid.major = element_blank(), axis.title.y = element_blank(),panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) + 
  theme(
  plot.title = element_text(color = "black", size = 10, face = "italic", hjust=0.5))
#poliomiss
```

# Polio vs all other attributes
+ Polio cases do seem to go down from 2000 to 2015 but slower decrease than that observed in measles
+ Polio seems to have almost no cases in Developed vs developing!
+ **create more graphs to get deeper insights**
+ ** looking online "Polio is transmitted through contaminated water and food or contact with an infected person." which would explain the developed vs developing graph 
+ Nigeria and Haiti seem to have the highest cases per Country y
+ The graph for code has IRL and MUS as the highest cases
+ **Definetly more graphs on countries for all diseases, as the graphs do noe include all countries**



```{r, echo=FALSE ,message=FALSE, warning=FALSE,  fig.width = 7, fig.align = "center"}
# Dopping Total.expenditure , Schooling , Population , Income.composite.of.resources , Hepatitis.B , GDP , Alcohol
# Dro missing thinness.5.9.years thinness..1.19.years, BMI

#Create new variable
Polio2$YouthThinness=Polio2$thinness..1.19.years + Polio2$thinness.5.9.years
Polio2=Polio2 %>% select(-thinness..1.19.years,-thinness.5.9.years)

#Dropping all with columns
Polio2=Polio2 %>% select(-Total.expenditure,-Population,-Income.composition.of.resources,-Hepatitis.B, -GDP, -Alcohol)


Polio2$Schooling[is.na(Polio2$Schooling)] <- 0
newData= na.omit(Polio2)
#sapply(newData, function(x) all_miss=sum(is.na(x)))
newData$Status=as.factor(newData$Status)
newData$Country.x=as.factor(newData$Country.x)
newData$Country.y=as.factor(newData$Country.y)
newData$Code1=as.factor(newData$Code1)
newData$Code=as.factor(newData$Code)
newData$Year=as.factor(newData$Year)

par(mfrow=c(1,2))
plot(PolioCases~., data = newData)
```


```{r, include=FALSE ,message=FALSE, warning=FALSE,  fig.width = 7, fig.align = "center"}

all_missing=data.frame(Count=(c(sapply(Hepb2, function(x) all_miss=sum(is.na(x))))), columns=names(Hepb2))

all_missing[all_missing == "Income.composition.of.resources"] = "IncomeResources"
all_missing[all_missing == "percentage.expenditure"] = "%Expenditure"

#Plot!
hempmiss=all_missing %>% ggplot(aes(x=Count, y=columns, fill=columns)) + geom_col(position = "dodge") +
  xlab("Total amount of missing values") + ggtitle("Missing values per variable in Hepititis dataset") +
  geom_text(size=3,position = position_dodge(width= .5), aes(label=Count),vjust=0.5, hjust = -0.20) +
  theme(axis.text = element_text(size = 10)) + ylab("Variable")+ theme(legend.position="none") +  theme(panel.grid.major = element_blank(), axis.title.y = element_blank(),panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) + 
  theme(
  plot.title = element_text(color = "black", size = 10, face = "italic", hjust=0.5))
#hempmiss

```

# HepititisB vs all other attributes
+ There is definetly a decrease in hepatitis cases from 2000 to 20018. The mean decreases and so does the standard deviation
+ We see again a diffent mean in developed vs developing.A mean of about 200 in developed to a mean of  about 1000 in developing.
+ **create a anova to see if it is also statistically significant?**
+ Adult mortality and hepatitis do have a linear relationship!
+ there is also a negative relationship between life expectancy and a measles. THe more measles cases the lower the life expectancy the lower or no measles cases lead to highes life expectancy.
+ there is also a negative relationship with BMI.
+ **there seems to be a relationship, positive, between HIV and hepatitis.we might need to look into it**
+ there is a negative relationship between diptheria and Hepatitis
+ **we could look into it**
+ schooling vs Hepatitis b have a negative relationship
+ youth thiness does have a positive relationship with hepatitis which makes sense

```{r, echo=FALSE ,message=FALSE, warning=FALSE,  fig.width = 7, fig.align = "center"}
# Dopping Total.expenditure  , Population , Income.composite.of.resources , Hepatitis.B , GDP , Alcohol
# Dro missing thinness.5.9.years thinness..1.19.years, BMI
# add 0 for schooling

#Create new variable
Hepb2$YouthThinness=Hepb2$thinness..1.19.years + Hepb2$thinness.5.9.years
Hepb2=Hepb2 %>% select(-thinness..1.19.years,-thinness.5.9.years)

#Dropping all with columns
Hepb2=Hepb2 %>% select(-Total.expenditure,-Population,-Income.composition.of.resources,-Hepatitis.B, -GDP, -Alcohol)
Hepb2$Schooling[is.na(Hepb2$Schooling)] <- 0
newData= na.omit(Hepb2)
#sapply(newData, function(x) all_miss=sum(is.na(x)))
newData$Status=as.factor(newData$Status)
newData$Country.x=as.factor(newData$Country.x)
newData$Country.y=as.factor(newData$Country.y)
newData$Code1=as.factor(newData$Code1)
newData$Code=as.factor(newData$Code)
newData$Year=as.factor(newData$Year)


par(mfrow=c(1,2))
plot(HepatitisCases~., data = newData)
```

```{r, include=FALSE ,message=FALSE, warning=FALSE, fig.width = 7, fig.align = "center"}

all_missing=data.frame(Count=(c(sapply(Tuberc2, function(x) all_miss=sum(is.na(x))))), columns=names(Tuberc2))

all_missing[all_missing == "Income.composition.of.resources"] = "IncomeResources"
all_missing[all_missing == "percentage.expenditure"] = "%Expenditure"

#Plot!
tubermiss=all_missing %>% ggplot(aes(x=Count, y=columns, fill=columns)) + geom_col(position = "dodge") +
  xlab("Total amount of missing values") + ggtitle("Missing values per variable in Tuberculosis") +
  geom_text(size=3,position = position_dodge(width= .5), aes(label=Count),vjust=0.5, hjust = -0.20) +
  theme(axis.text = element_text(size = 10)) + ylab("Variable")+ theme(legend.position="none") +  theme(panel.grid.major = element_blank(), axis.title.y = element_blank(),panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) + 
  theme(
  plot.title = element_text(color = "black", size = 10, face = "italic", hjust=0.5))

#tubermiss
```

# Tuberculosis vs all other attributes
+ There is no clear decline of mean deacreas on Tuberculosis per 100000 people crom 200 to 20014.however the range does decreases through the years slightly. 
+ **need to look if there is a vaccine for tuberculosis or more info on it**
+ Developed vs developing has a huge difference the mean in developed is very small. Almos 5 in developed compared to about 20 in developing which is not that much but it has very large outlier and bigger standar devaiation.
+ Life Expectancy has a negative relationship with tuberculosis 
+ adult mortality has a positive relationship with tuberbulosis. the more cases he more changes of dying earlier in age.
+ **what do you all think of the infant deaths? there seems to be somwhat a small positive relationshio..**
+ no relationship with BMI
+ inmunization of polio vs tuberculosis seem to have a negative reationship 
+ same for diphtheria nagative relationship with tubercuosis.
+ **we might want to look into that**
+ Also interesting positive relationship with HIV.AIDS
+ **We should look into that.**

```{r, echo=FALSE,message=FALSE , warning=FALSE,  fig.width = 7, fig.align = "center"}
# Dopping Total.expenditure  , Population , Income.composite.of.resources , Hepatitis.B , GDP , Alcohol
# Dro missing thinness.5.9.years thinness..1.19.years, BMI
# add 0 for schooling

#Create new variable
Tuberc2$YouthThinness=Tuberc2$thinness..1.19.years + Tuberc2$thinness.5.9.years
Tuberc2=Tuberc2 %>% select(-thinness..1.19.years,-thinness.5.9.years)

#Dropping all with columns
Tuberc2=Tuberc2 %>% select(-Total.expenditure,-Population,-Income.composition.of.resources,-Hepatitis.B, -GDP, -Alcohol)
Tuberc2$Schooling[is.na(Tuberc2$Schooling)] <- 0
newData= na.omit(Tuberc2)
#sapply(newData, function(x) all_miss=sum(is.na(x)))
newData$Status=as.factor(newData$Status)
newData$Country.x=as.factor(newData$Country.x)
newData$Country.y=as.factor(newData$Country.y)
newData$Code1=as.factor(newData$Code1)
newData$Code=as.factor(newData$Code)
newData$Year=as.factor(newData$Year)

par(mfrow=c(1,2))
plot(TuberculosisCasesPer100000ppl~., data = newData)
```

```{r  echo=FALSE, warning=FALSE,message=FALSE}
mesmiss
poliomiss
hempmiss
tubermiss

# MERGING ALL DATA

#hepatitis$dissease=rep("hepatitis", dim(hepatitis)[1])
#tubercul$dissease=rep("tubercul", dim(tubercul)[1])
#measle$dissease=rep("measle", dim(measle)[1])
#polio$dissease=rep("polio", dim(polio)[1])

#full <- merge(hepatitis, tubercul, by = "Entity")
#full <- merge(full, measle, by="Entity")
#full<-merge(full,polio, by="Entity")

```

# Developed vs developing
```{r include=FALSE}
toPlot <- function(a) {
  newData= na.omit(a)
  newData$Status=as.factor(newData$Status)
  newData$Country.x=as.factor(newData$Country.x)
  newData$Country.y=as.factor(newData$Country.y)
  newData$Code1=as.factor(newData$Code1)
  newData$Code=as.factor(newData$Code)
  newData$Year=as.factor(newData$Year)
  return(newData)
   
}

tub2=toPlot(Tuberc2)
hp2=toPlot(Hepb2)

par(mfrow=c(1,2))
plot(TuberculosisCasesPer100000ppl~., data = tub2, col=tub2$Status)
plot(HepatitisCases~., data = hp2, col=hp2$Status)

```

# Single data with total cases of each disease per country 
```{r, echo=FALSE}
library(dplyr)
# Amount of cases
TuberTotal=Tuberc2  %>% group_by(Country.y, Status) %>% summarise(TuberculosisCases=sum(TuberculosisCasesPer100000ppl))
Hepb2Total=Hepb2  %>% group_by(Country.y, Status) %>% summarise(HepatitisCases=sum(HepatitisCases))
PolioTotal=Polio2  %>% group_by(Country.y, Status) %>% summarise(PolioCases=sum(PolioCases))
MeaslesTotal=Measles2  %>% group_by(Country.y, Status) %>% summarise(MeaslesCases=sum(MeaslesCases))


full <- merge(TuberTotal, Hepb2Total, by = "Country.y")
full <- merge(full, PolioTotal, by = "Country.y") %>% select(Country.y,Status.x,PolioCases,TuberculosisCases)
full <- merge(full, MeaslesTotal, by = "Country.y") %>% select(Country.y,Status.x,MeaslesCases,PolioCases,TuberculosisCases)


allCases = gather(full, disease, cases,MeaslesCases:TuberculosisCases, factor_key=TRUE  )

head(allCases)


```
# Developed vs Developing

+ The data is composed of 17% developed countries and 83% developing
+ When filter the data with country disease that is 0 it changes 2%. It changes 15% developed and 85% developing

```{r, echo=FALSE, warning=FALSE, message=FALSE}
perAllCases=allCases %>% group_by(Status.x) %>%
  dplyr::summarize(TotalCountries=n()) %>% mutate(percent = round((TotalCountries / sum(TotalCountries))*100)) %>% cbind(allCases %>% filter(cases>0) %>% group_by(Status.x) %>%
  dplyr::summarize(TotalCountrieswithDisease=n()) %>% mutate(percentWithDisease = round((TotalCountrieswithDisease / sum(TotalCountrieswithDisease))*100)) %>% select(TotalCountrieswithDisease,percentWithDisease))

perAllCases$WithoutDisease=perAllCases$TotalCountries-perAllCases$TotalCountrieswithDisease

#perAllCases

perAllCases  %>% ggplot(aes(x=Status.x, y=percentWithDisease, fill=Status.x)) + geom_col()+
geom_text(data=perAllCases, aes(x=Status.x, label=paste(percentWithDisease,"%"), y=percent, fill=NULL), nudge_y=5) +  scale_fill_manual(values=c("lightblue","cyan3"))+ theme_classic() + ggtitle("Pecent of developed and developing with diseases ")+ xlab("Status")
```

```{r, include=FALSE, warning=FALSE, message=FALSE}

perStatus <- function(a) {
  newData=a %>% group_by(Status) %>%
  dplyr::summarize(count=n()) %>% mutate(percent = round((count / sum(count))*100))
  return(newData)
    
}

tuberPerc=perStatus(TuberTotal)
hpbPerc=perStatus(Hepb2Total)
polioPerc=perStatus(PolioTotal)
measrPerc=perStatus(MeaslesTotal)

a=tuberPerc %>% ggplot(aes(x=Status, y=percent, fill=Status)) + geom_col()+
geom_text(data=tuberPerc, aes(x=Status, label=paste(percent,"%"), y=percent, fill=NULL), nudge_y=5) +
  scale_fill_manual(values=c("lightblue",
                             "cyan3"))+ theme_classic() + ggtitle("Pecent status Tuberculosis Data ")

b=hpbPerc %>% ggplot(aes(x=Status, y=percent, fill=Status)) + geom_col()+
geom_text(data=tuberPerc, aes(x=Status, label=paste(percent,"%"), y=percent, fill=NULL), nudge_y=5) +
  scale_fill_manual(values=c("lightblue",
                             "cyan3"))+ theme_classic() + ggtitle("Pecent status HPB2 Data ")


c=polioPerc %>% ggplot(aes(x=Status, y=percent, fill=Status)) + geom_col()+
geom_text(data=tuberPerc, aes(x=Status, label=paste(percent,"%"), y=percent, fill=NULL), nudge_y=5) +
  scale_fill_manual(values=c("lightblue",
                             "cyan3"))+ theme_classic() + ggtitle("Pecent status in Polio Data ")

d=measrPerc %>% ggplot(aes(x=Status, y=percent, fill=Status)) + geom_col()+
geom_text(data=tuberPerc, aes(x=Status, label=paste(percent,"%"), y=percent, fill=NULL), nudge_y=5) +
  scale_fill_manual(values=c("lightblue",
                             "cyan3"))+ theme_classic() + ggtitle("Pecent status in measles Data ")
grid.arrange(a,b,c,d, ncol=2)
```









